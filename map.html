<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cambodia Conflict Map: Civilian Hardships</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="map.html">Map</a></li>
        <li><a href="media.html">Media & Supporters</a></li>
        <li><a href="weapons.html">Weapons</a></li>
        <li><a href="donate.html">Donate</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <section id="map-section">
      <h1>Civilian Hardships: Displacement and Damage by Province</h1>
      <p>Data as of July 30, 2025, 17:45 (Cambodia Official Reports)</p>
      <div id="map"></div>
      <div id="province-info"></div>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 Cambodia-Thailand Conflict Documentary</p>
  </footer>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script>
    const map = L.map('map').setView([12.5657, 104.9910], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    fetch('assets/data/province-metrics.json')
      .then(response => response.json())
      .then(data => {
        const provinces = data.provinces;

        // Heatmap scaled to displacement
        const maxDisplaced = Math.max(...provinces.map(p => p.metrics.displaced));
        const heatPoints = provinces.map(p => [
          p.coords[0], p.coords[1], p.metrics.displaced / maxDisplaced
        ]);
        L.heatLayer(heatPoints, { radius: 25, blur: 15, maxZoom: 17 }).addTo(map);

        // Province click and hover events
        provinces.forEach(province => {
          const marker = L.marker(province.coords).addTo(map)
            .bindPopup(`
              <b>${province.name}</b><br>
              Displaced: ${province.metrics.displaced.toLocaleString()} people<br>
              Civilians Killed: ${province.metrics.civilians_killed.toLocaleString()}<br>
              Military Killed: ${province.metrics.military_killed.toLocaleString()}<br>
              Civilian Houses: ${province.metrics.civilian_houses.toLocaleString()}<br>
              Commercial Buildings: ${province.metrics.commercial_buildings.toLocaleString()}<br>
              Hospitals: ${province.metrics.hospitals.toLocaleString()}<br>
              Temples/Pagodas: ${province.metrics.temples_pagodas.toLocaleString()}<br>
              Military Barracks: ${province.metrics.military_barracks.toLocaleString()}<br>
              Schools: ${province.metrics.schools.toLocaleString()}<br>
              <b>Media:</b><br>${province.media.join('<br>')}
            `);
          marker.on('click', () => {
            const infoDiv = document.getElementById('province-info');
            infoDiv.innerHTML = `
              <h2>${province.name}</h2>
              <ul class="metrics-list">
                <li><strong>Displaced:</strong> ${province.metrics.displaced.toLocaleString()} people</li>
                <li><strong>Civilians Killed:</strong> ${province.metrics.civilians_killed.toLocaleString()}</li>
                <li><strong>Military Killed:</strong> ${province.metrics.military_killed.toLocaleString()}</li>
                <li><strong>Civilian Houses:</strong> ${province.metrics.civilian_houses.toLocaleString()}</li>
                <li><strong>Commercial Buildings:</strong> ${province.metrics.commercial_buildings.toLocaleString()}</li>
                <li><strong>Hospitals:</strong> ${province.metrics.hospitals.toLocaleString()}</li>
                <li><strong>Temples/Pagodas:</strong> ${province.metrics.temples_pagodas.toLocaleString()}</li>
                <li><strong>Military Barracks:</strong> ${province.metrics.military_barracks.toLocaleString()}</li>
                <li><strong>Schools:</strong> ${province.metrics.schools.toLocaleString()}</li>
              </ul>
              <h3>Media</h3>
              <ul>${province.media.map(m => `<li>${m}</li>`).join('')}</ul>
            `;
            infoDiv.classList.add('active');
          });
          marker.on('mouseover', () => {
            marker.openPopup();
          });
          marker.on('mouseout', () => {
            marker.closePopup();
          });
        });
      });
  </script>
</body>
</html>
